# Snow CLI 使用文档——漏洞猎人模式

欢迎使用 Snow CLI！在终端中进行 Agentic 编程。

## 什么是漏洞猎人模式

漏洞猎人模式（Vulnerability Hunting Mode）是 Snow CLI 的一个专业安全分析代理模式，专注于发现和验证代码库中的安全漏洞。与普通对话模式不同，该模式会遵循严格的安全分析流程，提供系统化的漏洞检测、证据收集、验证脚本生成和详细报告。

## 为什么使用漏洞猎人模式

在软件开发过程中，安全漏洞可能导致严重后果。漏洞猎人模式提供了专业的安全分析能力：

- 系统化的漏洞检测流程，涵盖多种漏洞类型
- 基于证据的分析，避免误报
- 为每个漏洞生成可执行的验证脚本
- 详细的修复建议和优先级排序
- 交互式沟通，确保分析范围准确
- 专注于特定模块，避免泛泛而谈

## 启用漏洞猎人模式

### 使用指令切换

在 Snow CLI 对话界面输入：

```
/vulnerability-hunting
```

系统会显示模式切换提示，再次输入该指令可以关闭该模式。

### 模式状态

- 模式状态会保存在 localStorage 中
- 重启应用后保持上次的状态
- 可以随时切换回普通模式

## 核心原则

漏洞猎人模式遵循以下核心原则：

### 1. 用户查询优先

AI 会优先响应您的实际问题和需求，不会在您没有要求时擅自分析整个代码库。

### 2. 语言适应

AI 始终使用与您相同的语言进行回复和生成报告。

### 3. 交互式沟通

AI 会频繁使用交互式问答来：
- 澄清模糊的需求
- 确认分析范围
- 询问具体测试场景
- 验证发现的问题
- 获取修改代码的权限

### 4. 基于证据的分析

所有漏洞报告必须有具体的代码证据，AI 不会进行猜测或假设。

### 5. 聚焦范围

每次只分析特定的模块或组件，不会一次性分析整个代码库。

### 6. 验证要求

每个漏洞都必须有验证脚本或概念验证代码。

### 7. 只读分析

除非您明确要求，否则 AI 不会修改源代码，只会生成报告和建议。

## 完整工作流程

漏洞猎人模式遵循严格的5阶段工作流程：

### 阶段 1：范围定义（强制性）

**目标**：明确定义要分析的具体区域。

**流程**：

1. **如果您没有指定模块**：
   - AI 会探索代码库结构
   - 列出主要模块和组件
   - 询问您想分析哪个具体区域

2. **如果您指定了模糊区域**：
   - AI 会将其细分为更小的子组件
   - 询问您是否关注所有部分还是特定部分

3. **开始分析前确认**：
   - 优先检查哪类漏洞（逻辑错误 vs 安全问题）
   - 预期的分析深度
   - 是否有特定关注点或已知问题

## 使用场景示例

### 场景 1：分析特定模块

您：进入漏洞猎人模式，分析认证模块

AI：好的，我已切换到漏洞猎人模式。让我先探索认证模块的结构...

我发现了以下认证相关组件：

1. 登录流程（login.ts, auth.ts）
2. 会话管理（session.ts, middleware.ts）
3. 密码重置（resetPassword.ts）
4. Token 处理（jwt.ts, tokenService.ts）

您想先分析哪个具体区域？还是我应该检查所有组件？

您：先检查 JWT token 处理

AI：明白了。在开始分析前，我想确认一下：

您希望我优先关注：
1. 逻辑错误（空值检查、边界情况、竞态条件）
2. 安全问题（注入、认证绕过、数据泄露）
3. 两者都检查

您：两者都检查

AI：好的，我将全面分析 JWT token 处理模块...

[执行分析...]

我发现了以下问题：
1. [严重] JWT 签名验证缺失
2. [高危] Token 过期检查逻辑错误
3. [中危] 缺少 Token 刷新机制

我已经创建了验证脚本。您想查看详细报告吗？

### 场景 2：验证已知问题

您：我怀疑用户输入处理有 SQL 注入问题，帮我验证一下

AI：好的，让我定位用户输入处理的相关代码...

我找到了这些处理用户输入的地方：
- src/controllers/userController.ts:searchUser()
- src/controllers/productController.ts:search()
- src/services/queryBuilder.ts:buildQuery()

这些都是您关注的吗？还是有特定的函数？

您：主要是 searchUser 函数

AI：明白了。我将重点分析该函数的 SQL 注入风险...

[分析后...]

确认发现 SQL 注入漏洞！详情：
- 位置：src/controllers/userController.ts:42
- 问题：直接拼接用户输入到 SQL 查询
- 严重程度：严重

我已创建验证脚本：.snow/vulnerability-hunting/scripts/verify-sql-injection.sh

运行该脚本可以实际触发漏洞。需要我生成详细报告和修复建议吗？

### 场景 3：生成安全报告

您：为整个 API 模块生成安全分析报告

AI：好的，API 模块很大。让我先列出主要的子模块：

1. 用户 API（/api/users/*）
2. 产品 API（/api/products/*）
3. 订单 API（/api/orders/*）
4. 认证 API（/api/auth/*）
5. 管理 API（/api/admin/*）

由于模块较多，建议分批分析。您想从哪个开始？
还是我应该做一个快速的高层次扫描，找出最明显的问题？

您：先做快速扫描，找出严重问题

AI：明白了，我将进行快速安全扫描，重点关注严重漏洞...

[扫描后...]

快速扫描完成，发现以下严重问题：

1. [严重] 用户 API：SQL 注入（3处）
2. [严重] 认证 API：JWT 签名验证缺失
3. [严重] 管理 API：缺少权限检查
4. [高危] 订单 API：竞态条件可能导致重复扣款

建议先修复这些严重问题。需要我对每个问题创建详细报告和验证脚本吗？


## 文件结构

漏洞猎人模式生成的所有文件都存储在项目的 `.snow/vulnerability-hunting/` 目录下：

```text
.snow/
└── vulnerability-hunting/
    ├── docs/                           # 分析报告目录
    │   ├── auth-module.md             # 认证模块报告
    │   ├── api-security-scan.md       # API 安全扫描报告
    │   └── payment-module.md          # 支付模块报告
    └── scripts/                        # 验证脚本目录
        ├── verify-jwt-bypass.js       # JWT 绕过验证
        ├── verify-sql-injection.sh    # SQL 注入验证
        ├── verify-race-condition.js   # 竞态条件验证
        └── verify-auth-bypass.py      # 认证绕过验证
```


### 报告命名规范

- 使用小写字母和连字符
- 格式：`[模块名]-[报告类型].md`
- 示例：`auth-module.md`、`api-security-scan.md`

### 脚本命名规范

- 使用小写字母和连字符
- 格式：`verify-[漏洞类型].[扩展名]`
- 示例：`verify-sql-injection.sh`、`verify-null-pointer.js`

## 最佳实践

### 1. 明确分析范围

不要要求分析整个代码库，而是：
- 指定具体的模块或组件
- 明确关注的漏洞类型
- 提供已知的风险点

### 2. 及时沟通

AI 会频繁询问以确认细节，请：
- 回答 AI 的问题以明确需求
- 提供额外的上下文信息
- 说明特定的安全关注点

### 3. 验证发现

对于 AI 发现的问题：
- 运行提供的验证脚本
- 在测试环境中确认
- 评估实际影响

### 4. 优先级修复

根据报告中的优先级：
- 立即修复严重漏洞
- 按优先级排序其他问题
- 记录修复过程

### 5. 持续改进

漏洞修复后：
- 要求 AI 重新验证
- 添加安全测试
- 更新安全检查清单

## 限制和注意事项

### 1. 分析范围

- 每次只分析特定模块，不是整个代码库
- 需要明确指定分析范围
- 大型项目建议分多次分析

### 2. 验证脚本

- 脚本应在隔离环境中运行
- 某些脚本可能需要特定的测试环境
- 运行前请仔细阅读脚本内容

### 3. 只读模式

- 默认情况下不修改源代码
- 只生成报告和修复建议
- 需要代码修复时必须明确要求

### 4. 误报可能性

- AI 分析可能产生误报
- 始终验证发现的问题
- 结合人工审查

### 5. 覆盖范围

- 不能保证发现所有漏洞
- 专注于常见和严重的安全问题
- 建议结合其他安全工具

## 常见问题

**Q: 漏洞猎人模式和普通模式有什么区别？**

A: 漏洞猎人模式是专门的安全分析代理，遵循严格的5阶段工作流程，生成详细报告和验证脚本。普通模式更通用，适合日常开发任务。

**Q: 分析一个模块需要多长时间？**

A: 取决于模块大小和复杂度。小型模块（几百行）可能需要几分钟，中型模块（几千行）可能需要10-30分钟，大型模块建议拆分分析。

**Q: 验证脚本安全吗？**

A: 验证脚本设计为安全运行，不会造成永久性损害。但建议在隔离的测试环境中运行，不要在生产环境执行。

**Q: AI 可以自动修复漏洞吗？**

A: 默认情况下不会。AI 只提供修复建议。如果需要自动修复，必须明确要求，AI 会先征求您的确认。

**Q: 如何查看之前的分析报告？**

A: 所有报告保存在 `.snow/vulnerability-hunting/docs/` 目录下，可以随时查看。

**Q: 可以自定义分析类别吗？**

A: 可以。AI 会在开始前询问您关注哪些类别。您可以指定只检查逻辑错误、只检查安全问题，或两者都检查。

**Q: 漏洞猎人模式支持哪些编程语言？**

A: 支持常见的编程语言，包括 JavaScript/TypeScript、Python、Java、Go、Rust、C# 等。分析质量取决于代码库的索引状态。

**Q: 发现的漏洞会自动报告给团队吗？**

A: 不会。所有报告只存储在本地。您需要手动分享报告或集成到您的安全工作流中。

**Q: 可以导出报告到其他格式吗？**

A: 报告以 Markdown 格式生成，可以轻松转换为 PDF、HTML 或其他格式。您也可以要求 AI 生成特定格式的报告。

**Q: 如何结合 CI/CD 使用？**

A: 可以在 CI/CD 流程中运行验证脚本，检测已知漏洞是否修复。但完整的分析建议手动触发，因为需要交互式沟通。

## 相关功能

- [指令面板说明](./9.指令面板说明.md) - 了解 `/vulnerability-hunting` 等指令
- [敏感命令配置](./6.敏感命令配置.md) - 配置需要确认的危险命令
- [代码库设置](./4.代码库设置.md) - 启用代码库索引以提升分析效果
