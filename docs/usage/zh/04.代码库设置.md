# Snow CLI 使用文档——代码库设置

欢迎使用 Snow CLI！在终端中进行 Agentic 编程。

## 代码库设置

Snow CLI 支持启用本地代码库功能。

_代码库是一个基于向量搜索的 Sqlite 数据库，用于存储代码库的源代码和注释。并通过向量化自然语言查询。_

## 配置存储

代码库配置分为两部分：

- **项目级配置** (`.snow/codebase.json`)：存储在项目根目录，控制当前项目的启停状态和索引参数
- **全局配置** (`~/.snow/codebase.json`)：存储 Embedding 服务配置，跨项目共享

这样每个项目可以独立控制代码库功能的启停，而 Embedding 配置只需配置一次。

## 快速启停

使用 `/codebase` 命令可以快速控制当前项目的代码库功能：

- `/codebase` - 切换启停状态
- `/codebase on` - 启用代码库
- `/codebase off` - 禁用代码库
- `/codebase status` - 查看当前状态

首次启用时，需要先在 `/home` 中配置 Embedding 服务。

## Embedding 服务配置

- 代码库支持两种请求方案：Jina（OpenAI 兼容）和 Ollama（本地部署，支持 OpenAI 兼容 `/v1/embeddings` 与原生 `/api/embed`）。

- 代码库的 BaseURL（支持多种写法，程序会自动补全/规范化到最终端点）：

  - Jina（OpenAI 兼容）支持：`https://api.jina.ai`、`https://api.jina.ai/v1`、`https://api.jina.ai/v1/embeddings`（最终请求 `.../v1/embeddings`）。
  - Ollama 支持：`http://localhost:11434`、`http://localhost:11434/v1`、`http://localhost:11434/v1/embeddings`（OpenAI 兼容）；以及 `http://localhost:11434/api`、`http://localhost:11434/api/embed`（Ollama 原生）。

- 嵌入维度：填写嵌入模型支持的维度即可；部分服务可能忽略 `dimensions` 参数，若返回维度不一致会在日志中提示。

## 索引参数配置

- 分块配置：配置代码如何分割成块以进行索引。这些设置控制代码段的大小和重叠：
  - `maxLinesPerChunk`：每个分块的最大行数（默认：200）
  - `minLinesPerChunk`：每个分块的最小行数（默认：10）
  - `minCharsPerChunk`：每个分块的最小字符数（默认：20）
  - `overlapLines`：连续分块之间的重叠行数（默认：20）
    这些设置影响搜索准确性和索引性能。
- 批处理配置：控制文件如何分批处理以提高索引效率：
  - `maxLines`：每个批处理请求的最大行数（默认：10）
  - `concurrency`：并发批处理操作数（默认：3）
    这控制每次请求发送到嵌入 API 的 `input` 项数量。

**注意：批处理最大行数代表请求体中的 `input` 数，而非代码切片的行数**

## 相关功能

启用代码库索引后，以下功能会得到显著增强：

- [漏洞猎人模式](./11.漏洞猎人模式.md) - 代码库索引可以大幅提升安全分析的准确性和效率
- [指令面板说明](./09.指令面板说明.md) - 使用 `/reindex` 重建代码库索引，使用 `/codebase` 控制启停
