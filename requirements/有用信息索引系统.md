<!-- 编写有用信息系统时比较早
但当时是参考 todo系统 制作的
后续todo系统经过重构优化升级
但 有用信息系统一直没有升级

故现在需要 再参考 现在的 todo 系统 重构优化升级 有用信息系统
有用信息不用展示在 UI上
只是有用信息的存储,读取等,看看有没有可以向todo系统学习的
比如现在todo存储会按项目分文件夹

# 有用信息系统升级总结

## 升级时间
2026-01-30

## 升级背景
有用信息系统编写时间较早,当时参考了todo系统制作。后续todo系统经过重构优化升级,但有用信息系统一直没有升级。为了保持系统一致性和可维护性,决定参考现在的todo系统重构升级有用信息系统。

## 主要变更

### 1. 项目层级存储 ✅
**修改前:**
```
~/.snow/usefulInfo/YYYY-MM-DD/sessionId.json
```

**修改后:**
```
~/.snow/usefulInfo/{projectId}/YYYY-MM-DD/sessionId.json
```

**好处:**
- 与Session和TODO系统保持一致的路径结构
- 不同项目的有用信息完全隔离
- 通过`sessionManager.getProjectId()`动态获取当前项目ID

**实现位置:**
- `source/utils/execution/mcpToolsManager.ts:124-135`

### 2. 向下兼容旧数据 ✅
系统完全支持读取旧格式数据:
- 旧格式路径: `~/.snow/usefulInfo/sessionId.json`
- 新格式路径: `~/.snow/usefulInfo/{projectId}/YYYY-MM-DD/sessionId.json`
- 读取时优先尝试旧格式,不存在则搜索新格式

**实现位置:**
- `source/mcp/usefulInfo.ts:156-176` (getUsefulInfoList方法)

### 3. 代码优化 ✅
- 添加了`legacyInfoDir`属性存储旧格式路径
- 在constructor注释中明确说明路径结构
- 统一使用`formatDateForFolder`工具函数

## 技术细节

### 修改的文件
1. **source/utils/execution/mcpToolsManager.ts**
   - 修改`getUsefulInfoService()`函数
   - 添加项目ID获取逻辑
   - 统一路径结构命名

2. **source/mcp/usefulInfo.ts**
   - 添加`os`模块导入
   - 新增`legacyInfoDir`属性
   - 修改constructor初始化逻辑
   - 更新`getUsefulInfoList()`支持向下兼容

### 路径结构对比

#### Session系统
```
~/.snow/sessions/{projectId}/sessionId.json
```

#### TODO系统
```
~/.snow/todos/{projectId}/YYYY-MM-DD/sessionId.json
```

#### 有用信息系统(升级后)
```
~/.snow/usefulInfo/{projectId}/YYYY-MM-DD/sessionId.json
```

## 构建验证
✅ 构建通过 (npm run build)
- 无编译错误
- 无类型错误

## 未来可优化方向
虽然本次重构未实现以下功能,但可以参考TODO系统继续优化:
1. 添加事件系统(`usefulInfoEvents`)
2. 添加UI组件(`UsefulInfoList.tsx`)
3. 实现会话压缩时继承有用信息
4. 优化工具调用规则说明

## 测试建议
1. 测试新项目创建有用信息
2. 测试读取旧项目的有用信息(向下兼容)
3. 测试跨项目的有用信息隔离

 -->
已完成


