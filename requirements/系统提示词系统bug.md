<!-- 我在 系统提示词设置 已经激活了一个系统提示词
且 API 和模型设置 中 我使用的 api 也是 默认的 
    系统提示词（选填）
     跟随全局：cc
但我看 主代理的实际发送的请求中 system 并不是我设置的 系统提示词 而是 主代理的角色定义(和拼在后面的一些其他信息)

改改 应该 根据 API 和模型设置 来


子代理也得看看,目前子代理的系统提示词逻辑是正确的,应该是之前修复子代理提示词构成是意外破坏了主代理的提示词组装逻辑

此部分经过几次修复可能逻辑稍微繁杂,可以着手重构优化下这里的逻辑

注意可能涉及多个 Api 渠道


设置了系统提示词时,主代理的角色定义(和其拼接的信息等),应该退为usr
且 跟随特殊user 消息 一起 动态调整位置 见requirements/发送前添加的特殊user实际发送顺序修改.md

没设置系统提示词时,主代理的角色定义(和其拼接的信息等) 应该作为 system
且他们任然是特殊user 消息 一起 动态调整位置 (重复了没问题,因为这些信息重要,重复两次没事) -->


已完成

<!-- 
现在 子代理的系统提示词逻辑是错误的了,
设置了系统提示词时,系统提示词,并未 根据 API 和模型设置 中的 系统提示词 设置来
而是用了 子代理角色定义(和拼接的信息等)

现状错误证据:

{
  "messages": [
    {
      "role": "system",
      "content": "你是一个专门的代码探索子Agent.你的任务是根据给你的实际..."
    },
    {
      "role": "user",
      "content": "你是一个专门的代码探索子Agent.你的任务是根据给你的实际..."
    }
  ]
}
system 错了,没按照设置的 系统提示词 来,而是用了 子代理角色定义(和拼接的信息等)

以下是现在正确的主代理


{
  "messages": [
    {
      "role": "system",
      "content": "You are Claude Code, Anthropic..."
    },
    {
      "role": "user",
      "content": "[2026-01-31T14:28:22] requirem..."
    },
    {
      "role": "user",
      "content": "你是Snow AI CLI,一个工作在命令行环境中的智能助手..."
    }
  ]
}
 -->
已修复