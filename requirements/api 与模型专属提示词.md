<!-- # 需求文档

## 1. 项目现状与核心目标

当前项目存在两套提示词体系,一个是可配置系统提示词,一个是主代理与子代理的角色定义.系统提示词在 API 与模型设置中配置,以 system 发送,用于基础设定或供应商适配.角色定义在主代理与子代理配置中设置,以 user 发送,并拼接 AGENTS.md,系统环境,平台指导,任务完成标识等内容.
本需求希望在 API 与模型设置中新增模型专属提示词字段,用于针对具体模型纠正行为偏差.该字段仅对当前选择的 API 与模型配置生效,作为 user 内容插入到主代理与子代理角色定义之后,且不允许变量或占位符.

## 2. 范围与边界

**功能点简述**:

- [ ] 在 API 与模型设置中新增字段,名称为 模型专属提示词,默认空字符串.
- [ ] 该字段仅作用于当前 API 与模型配置(Profile),不影响其他 Profile.
- [ ] 内容类型为纯文本指令,不允许变量或占位符.
- [ ] 当字段为空或仅含空白时,视为未配置,不插入任何内容.
- [ ] 主代理与子代理的拼接顺序保持一致,插入位置固定在 角色定义 之后,AGENTS.md 之前.
- [ ] 完整拼接顺序(两类代理一致): 角色定义 -> 模型专属提示词 -> AGENTS.md -> 系统环境 -> 平台指导 -> 任务完成标识 -> 子代理任务提示词(仅子代理存在).

**排除项**:

- 不修改 system 提示词的配置与发送逻辑.
- 不改变角色定义,AGENTS.md,系统环境,平台指导,任务完成标识的内容来源与格式.
- 不新增变量解析,模板渲染,或自动填充行为.
- 不跨 Profile 共用模型专属提示词.

## 3. 举例覆盖需求和边缘情况

- **例 1: 正常配置**:
  Profile A 在 模型专属提示词 中填写 请避免冗余命令行搜索,优先基于已有上下文. 主代理与子代理发送时,在角色定义后加入该文本,其余拼接顺序不变.
- **例 2: 空值处理**:
  Profile B 的 模型专属提示词 为空或仅包含空格,系统不插入任何额外文本,拼接顺序退回为 角色定义 -> AGENTS.md -> 系统环境 -> 平台指导 -> 任务完成标识.
- **例 3: Profile 隔离**:
  Profile A 配置了模型专属提示词,Profile C 未配置,当切换到 Profile C 时,不应出现 Profile A 的提示词.
- **例 4: 子代理任务提示词存在**:
  子代理执行任务时,模型专属提示词插入在角色定义后,AGENTS.md 前,任务提示词仍保持在所有拼接内容之后.
- **例 5: 供应商适配**:
  系统提示词用于供应商适配且要求一字不差,模型专属提示词不进入 system,仅进入 user,避免破坏供应商要求. -->
已完成